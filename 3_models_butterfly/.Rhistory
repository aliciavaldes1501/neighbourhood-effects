effectin<-data.frame(effect(term="scale(phen_int)", mod=model1_ME,
xlevels=list(phen_int=1:6)))
library(effects)
effectin<-data.frame(effect(term="scale(phen_int)", mod=model1_ME,
xlevels=list(phen_int=1:6)))
ggplot(effectin, aes(phen_int,fit))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
ggplot(interaction1, aes(phen_int,fit))+
geom_smooth(method=loess,se=F,size=1,aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+
theme(legend.position="top")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
ggplot(interaction1, aes(phen_int,fit))+
geom_smooth(method=loess,se=F,size=1,aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+
theme(legend.position="top")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
effectin
ggplot(as.data.frame(allplants), aes(phen_int,seeds_per_fl))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Seeds per flower")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
ggplot(as.data.frame(allplants), aes(phen_int,seeds_per_fl))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,seeds_per_fl))+
xlab("Shoot phenology")+ylab("Seeds per flower")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
head(as.data.frame(allplants))
as.data.frame(allplants)$seeds_per_fl
head(allplants)
library(fmsb)
library(effects)
library(ggplot2)
library(nlme)
library(spdep)
library(ncf)
library(gstat)
library(ggthemes)
library(RColorBrewer)
library(cowplot)
library(gridExtra)
#Graphs ####
plot(effect(term="scale(phen_int):scale(Mrub_sch_s)",
mod=model1_ME,data=subset(allplants,!is.na(phen))),
x.var="phen_int",multiline=T,type="response")
plot(effect(term="scale(pldens_3):scale(phen_n3)",
mod=model1_ME,data=subset(allplants,!is.na(phen))),
x.var="pldens_3",multiline=T,type="response")
plot(effect(term="scale(phen_int)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),multiline=T,type="response")
plot(effect(term="scale(Mrub_sch_s)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),multiline=T,type="response")
plot(effect(term="scale(pldens_3):scale(phen_n3)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),
x.var="pldens_3",multiline=T,type="response")
p1<-ggplot(interaction1, aes(phen_int,fit, group = as.factor(Mrub_sch_s)))+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,fit,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
p2<-ggplot(interaction2, aes(pldens_3,fit, group = as.factor(phen_n3)))+
geom_smooth(method=loess,se=F,size=0.3,aes(pldens_3,fit,color=phen_n3))+
xlab("Neighbor density")+ylab("Probability of having eggs")+
theme_base()+ scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="none")+labs(colour="Neighbor phenology")+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
p3<-ggplot(effect1, aes(phen_int,fit))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+scale_y_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p4<-ggplot(effect2, aes(Mrub_sch_s,fit))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(Mrub_sch_s,fit))+
xlab("Ant abundance")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(0,5,10,15,20,25,30,35))+
scale_y_continuous(breaks=c(0,2,4,6,8,10,12,14,16))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p5<-ggplot(interaction3, aes(pldens_3,fit, group = as.factor(phen_n3)))+
geom_smooth(method=loess,se=F,size=0.3,aes(pldens_3,fit,color=phen_n3))+
xlab("Neighbor density")+ylab("Number of eggs")+
theme_base()+ scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Neigh. phenology")+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
ggdraw()+
draw_plot(p1,0.02,0.01,0.3,1)+
draw_plot(p3,1/3+0.04,0.01,0.3,0.81)+
draw_plot(p4,2/3+0.04,0.01,0.3,0.81)+
draw_label(label="A)",x=0.01,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="B)",x=0.39,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="C)",x=0.73,y=0.8, fontfamily = "serif", fontface = 1)
ggdraw()+
draw_plot(p2,0.02,0,0.45,0.83)+
draw_plot(p5,1/2,0,0.45,1)+
draw_label(label="A)",x=0.01,y=0.81, fontfamily = "serif", fontface = 1)+
draw_label(label="B)",x=0.53,y=0.81, fontfamily = "serif", fontface = 1)
moran_model1_ME
moran.mc_model1_ME
moran.mc_model1_ME
moran_model1_ME_1v #Better with both vectors
moran_model1_ME #ONLY LITTLE AUTOCORRELATION LEFT
library(fmsb)
library(effects)
library(ggplot2)
library(nlme)
library(spdep)
library(ncf)
library(gstat)
library(ggthemes)
library(RColorBrewer)
library(cowplot)
library(gridExtra)
#Graphs ####
plot(effect(term="scale(phen_int):scale(Mrub_sch_s)",
mod=model1_ME,data=subset(allplants,!is.na(phen))),
x.var="phen_int",multiline=T,type="response")
plot(effect(term="scale(pldens_3):scale(phen_n3)",
mod=model1_ME,data=subset(allplants,!is.na(phen))),
x.var="pldens_3",multiline=T,type="response")
plot(effect(term="scale(phen_int)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),multiline=T,type="response")
plot(effect(term="scale(Mrub_sch_s)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),multiline=T,type="response")
plot(effect(term="scale(pldens_3):scale(phen_n3)",
mod=model2,data=subset(allplants,!is.na(phen)&n_eggs_max>0)),
x.var="pldens_3",multiline=T,type="response")
interaction1<-data.frame(effect(term="scale(phen_int):scale(Mrub_sch_s)", mod=model1_ME,
xlevels=list(Mrub_sch_s=seq(0,35,1), phen_int=1:6)))
interaction2<-data.frame(effect(term="scale(pldens_3):scale(phen_n3)", mod=model1_ME,
xlevels=list(phen_n3=seq(2.8,6,0.05),pldens_3=0:50)))
effect1<-data.frame(effect(term="scale(phen_int)", mod=model2,xlevels=list(phen_int=seq(1,6,0.01))))
effect2<-data.frame(effect(term="scale(Mrub_sch_s)", mod=model2,xlevels=list(Mrub_sch_s=seq(0,35,1))))
interaction3<-data.frame(effect(term="scale(pldens_3):scale(phen_n3)", mod=model2,
xlevels=list(phen_n3=seq(2.8,6,0.05),pldens_3=0:50)))
myPalette <- colorRampPalette(rev(brewer.pal(11, "Spectral")))
p1<-ggplot(interaction1, aes(phen_int,fit, group = as.factor(Mrub_sch_s)))+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,fit,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
p2<-ggplot(interaction2, aes(pldens_3,fit, group = as.factor(phen_n3)))+
geom_smooth(method=loess,se=F,size=0.3,aes(pldens_3,fit,color=phen_n3))+
xlab("Neighbor density")+ylab("Probability of having eggs")+
theme_base()+ scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="none")+labs(colour="Neighbor phenology")+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
p3<-ggplot(effect1, aes(phen_int,fit))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+scale_y_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p4<-ggplot(effect2, aes(Mrub_sch_s,fit))+
geom_smooth(method=loess,se=T,size=1,color="black",aes(Mrub_sch_s,fit))+
xlab("Ant abundance")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(0,5,10,15,20,25,30,35))+
scale_y_continuous(breaks=c(0,2,4,6,8,10,12,14,16))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p5<-ggplot(interaction3, aes(pldens_3,fit, group = as.factor(phen_n3)))+
geom_smooth(method=loess,se=F,size=0.3,aes(pldens_3,fit,color=phen_n3))+
xlab("Neighbor density")+ylab("Number of eggs")+
theme_base()+ scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Neigh. phenology")+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
ggdraw()+
draw_plot(p1,0.02,0.01,0.3,1)+
draw_plot(p3,1/3+0.04,0.01,0.3,0.81)+
draw_plot(p4,2/3+0.04,0.01,0.3,0.81)+
draw_label(label="A)",x=0.01,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="B)",x=0.39,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="C)",x=0.73,y=0.8, fontfamily = "serif", fontface = 1)
p1<-ggplot(interaction1, aes(phen_int,fit, group = as.factor(Mrub_sch_s)))+geom_point()+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,fit,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
ggdraw()+
draw_plot(p1,0.02,0.01,0.3,1)+
draw_plot(p3,1/3+0.04,0.01,0.3,0.81)+
draw_plot(p4,2/3+0.04,0.01,0.3,0.81)+
draw_label(label="A)",x=0.01,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="B)",x=0.39,y=0.8, fontfamily = "serif", fontface = 1)+
draw_label(label="C)",x=0.73,y=0.8, fontfamily = "serif", fontface = 1)
p1
warnings()
interaction1
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point()+
geom_smooth(method=loess,se=T,size=1,color="black",aes(phen_int,fit))+
xlab("Shoot phenology")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+scale_y_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p3
effect1
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point()+
xlab("Shoot phenology")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+scale_y_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))+
geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.5,fill="grey")
p3
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point()+
xlab("Shoot phenology")+ylab("Number of eggs")+theme_base()+
scale_x_continuous(breaks=c(1,2,3,4,5,6))+scale_y_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
p3
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point()
p3
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point(size=0.1)
p3
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point(size=0.001)
p3
effect1<-data.frame(effect(term="scale(phen_int)", mod=model2,xlevels=list(phen_int=seq(1,6,0.1))))
p3<-ggplot(effect1, aes(phen_int,fit))+geom_point(size=0.001)
p3
model1_ME
ggplot(subset(allplants,!is.na(phen), aes(phen_int,attack, group = as.factor(Mrub_sch_s)))+geom_point()+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
ggplot(subset(allplants,!is.na(phen)), aes(phen_int,attack, group = as.factor(Mrub_sch_s)))+geom_point()+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,fit,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
ggplot(as.data.frame(subset(allplants,!is.na(phen))), aes(phen_int,attack, group = as.factor(Mrub_sch_s)))+geom_point()+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,fit,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
ggplot(as.data.frame(subset(allplants,!is.na(phen))), aes(phen_int,attack, group = as.factor(Mrub_sch_s)))+geom_point()+
geom_smooth(method=loess,se=F,size=0.3,aes(phen_int,attack,color=Mrub_sch_s))+
xlab("Shoot phenology")+ylab("Probability of having eggs")+theme_base()+scale_colour_gradientn(colours = myPalette(100))+
theme(legend.position="top")+labs(colour="Ant abundance")+scale_x_continuous(breaks=c(1,2,3,4,5,6))+
theme(text=element_text(family="serif"))+theme(plot.background=element_rect(fill="white", colour=NA))
warnings()
ggplot(as.data.frame(subset(allplants,!is.na(phen))), aes(phen_int,attack, group = as.factor(Mrub_sch_s)))+geom_point()+
geom_smooth(
)
hist1<-ggplot(as.data.frame(subset(allplants,!is.na(phen)&n_eggs_max==0)),aes(n_eggs_max))+
geom_histogram(binwidth=0.12,bins=50,color="black",fill="white")+
ylab("Proportion")+xlab(NULL)+ggtitle("N eggs = 0")+
scale_x_continuous(breaks=c(0))+
theme(text=element_text(family="serif"))+theme_bw()+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(plot.background=element_rect(fill="white", colour=NA))
library(ggplot)
library(ggplot2)
library(gridExtra)
hist1<-ggplot(as.data.frame(subset(allplants,!is.na(phen)&n_eggs_max==0)),aes(n_eggs_max))+
geom_histogram(binwidth=0.12,bins=50,color="black",fill="white")+
ylab("Proportion")+xlab(NULL)+ggtitle("N eggs = 0")+
scale_x_continuous(breaks=c(0))+
theme(text=element_text(family="serif"))+theme_bw()+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(plot.background=element_rect(fill="white", colour=NA))
hist2<-ggplot(as.data.frame(subset(allplants,!is.na(phen)&n_eggs_max>0)),aes(n_eggs_max))+
geom_histogram(bins=50,color="black",fill="white")+
ylab(NULL)+xlab(NULL)+ggtitle("N eggs > 0")+
theme(text=element_text(family="serif"))+theme_bw()+
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(plot.background=element_rect(fill="white", colour=NA))+
scale_x_continuous(breaks=c(1,5,10,15,20,25,30,35,40,45,50))
tiff("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.tiff",
res=600,width=26,height=9,units="cm",family="Times")
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
warnings()
dev.off()
dev.off()
dev.off()
tiff("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.tiff",
res=600,width=26,height=9,units="cm",family="Times")
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
tiff("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist.tiff",
res=600,width=26,height=9,units="cm",family="Times")
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
tiff("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.tiff",
res=600,width=26,height=9,units="cm")
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
dev.off()
hist1
hist2
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
library(ggplot2)
library(gridExtra)
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
dev.off()
tiff("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.tiff",
res=600,width=26,height=9,units="cm")
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
pdf("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.pdf",
res=600,width=26,height=9,units="cm")
pdf("C:/Users/Ali/Dropbox/SU/Projects/neighbourhood_effects/results/butterfly/figures/hist_n_eggs.pdf",width=26,height=9)
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
dev.off()
grid.arrange(hist1,hist2,ncol=2,widths=c(1,3),bottom="Number of eggs")
subset(allplants,n_eggs_max>0)
nrow(subset(allplants,n_eggs_max>0))
nrow(subset(allplants,n_eggs_max==1))
167/731
nrow(subset(allplants,n_eggs_max>1))
564/731
mean(subset(allplants,n_eggs_max>0)$n_eggs_max)
head(data_plants_paper)
#Load packages
library(MASS)
library(fmsb)
library(spdep)
library(rasterVis)
library(ncf)
library(maptools)
library(gstat)
library(ggplot2)
library(ggthemes)
library(effects)
library(cowplot)
#Read data ants
data_ants_paper<-read.table("C:/Users/User/Dropbox/SU/Projects/neighbourhood_effects/data/clean/data_ants_paper.txt",header=T,sep="\t",dec=".")
head(data_ants_paper)
str(data_ants_paper)
#Defining coordinates and coordinate system
coordinates(data_ants_paper) <- c("x", "y")
project1<-"+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" #RT90 0 gon (spatialreference.org)
proj4string(data_ants_paper) = CRS(project1) #assign CRS with projected coordinates
#Preparing a prediction grid
plot(data_ants_paper)
locator(4)
min_x =1499923 #minimun x coordinate
min_y =-51.043612 #minimun y coordinate
x_length = 1499995 - min_x #easting amplitude
y_length = -2.330070 - min_y #northing amplitude
cellsize = 0.18 #pixel size
ncol = round(x_length/cellsize,0) #number of columns in grid
nrow = round(y_length/cellsize,0) #number of rows in grid
grd1<-GridTopology(cellcentre.offset=c(min_x,min_y),cellsize=c(cellsize,cellsize),cells.dim=c(ncol,nrow))
#Convert GridTopolgy object to SpatialPixelsDataFrame object.
grd1<-SpatialPixelsDataFrame(grd1,
data=data.frame(id=1:prod(ncol,nrow)),
proj4string=CRS(project1))
plot(grd1)
#Cut grid with shapefile "mask" (20 cm out of the borders of the occupied plots)
mask<-readShapePoly("C:/Users/User/Dropbox/SU/projects/neighbourhood_effects/gis/shapefiles/mask_20cm.shp",IDvar=NULL,proj4string=CRS(project1))
plot(mask)
mask<-mask@polygons
mask<-SpatialPolygons(mask, proj4string=CRS(project1))
plot(mask)
grd1<-grd1[!is.na(over(grd1, mask)),]
plot(grd1)
#Inverse distance weighting (IDW) interpolation based on the values at the sampling points to generate values of the abundance of ant species
#over the surface of all occupied subplots.
#A maximum distance of 3 m was used because it represents the ground foraging distance of most investigated Myrmica species (Elmes et al. 1998).
#From these interpolated surfaces (see electronic supplementary material figures S1-5), we extracted values of abundance of the different ant
#species for each of the mapped shoots.
idw1_Mrub_sum<-idw(Mrub_sum ~ 1, data_ants_paper, grd1, idp = 1, maxdist=3)
idw1_Msca_sum<-idw(Msca_sum ~ 1, data_ants_paper, grd1, idp = 1, maxdist=3)
idw1_Mrug_sum<-idw(Mrug_sum ~ 1, data_ants_paper, grd1, idp = 1, maxdist=3)
idw1_Msch_sum<-idw(Msch_sum ~ 1, data_ants_paper, grd1, idp = 1, maxdist=3)
idw1_oth_sum<-idw(oth_sum ~ 1, data_ants_paper, grd1, idp = 1, maxdist=3)
#Figures inverse distance weighted interpolation for ant abundances (Figures S1-5)
myTheme=rasterTheme(region=c("#B3B3B3",brewer.pal('RdBu', n=11)))
levelplot(raster(idw1_Mrub_sum), par.settings=myTheme, margin=F,scales=list(draw=FALSE))
levelplot(raster(idw1_Msca_sum), par.settings=myTheme, margin=F,scales=list(draw=FALSE))
levelplot(raster(idw1_Mrug_sum), par.settings=myTheme, margin=F,scales=list(draw=FALSE))
levelplot(raster(idw1_Msch_sum), par.settings=myTheme, margin=F,scales=list(draw=FALSE))
levelplot(raster(idw1_oth_sum), par.settings=myTheme, margin=F,scales=list(draw=FALSE))
#Read data shoot phenology, neighbor density and phenology
data_plants_paper<-read.table("C:/Users/User/Dropbox/SU/Projects/neighbourhood_effects/data/clean/data_plants_paper.txt",header=T,sep="\t",dec=".")
head(data_plants_paper)
str(data_plants_paper)
#Defining coordinates and coordinate system
coordinates(data_plants_paper) <- c("x", "y")
proj4string(data_plants_paper) = CRS(project1) #assign CRS with projected coordinates
plot(data_plants_paper)
head(data_plants_paper)
tail(data_plants_paper)
str(data_plants_paper)
#Extrapolate ant data to every plant
data_plants_paper$Mrub_sum<-over(data_plants_paper,idw1_Mrub_sum)$var1.pred
data_plants_paper$Msca_sum<-over(data_plants_paper,idw1_Msca_sum)$var1.pred
data_plants_paper$Mrug_sum<-over(data_plants_paper,idw1_Mrug_sum)$var1.pred
data_plants_paper$Msch_sum<-over(data_plants_paper,idw1_Msch_sum)$var1.pred
data_plants_paper$oth_sum<-over(data_plants_paper,idw1_oth_sum)$var1.pred
head(data_plants_paper)
str(data_plants_paper)
#Summed abundance of all Myrmica species
data_plants_paper$allM_sum<-data_plants_paper$Mrub_sum+data_plants_paper$Msca_sum+data_plants_paper$Mrug_sum+data_plants_paper$Msch_sum
#Summed abundance of M. rubra and M. schencki
data_plants_paper$Mrub_sch_s<-data_plants_paper$Mrub_sum+data_plants_paper$Msch_sum
#Calculation of the probability  of a shoot having at least one egg  (0/1)
data_plants_paper$attack<-ifelse(data_plants_paper$n_eggs_max>0,1,0)
#Univariate GLMs relating the probability of having eggs to the abundance of different ant species (Table S1A)
summary(glm(attack ~scale(allM_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #-0.52232
summary(glm(attack ~scale(Mrub_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #0.17423
summary(glm(attack ~scale(Msca_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #-1.36392
summary(glm(attack ~scale(Mrug_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #-0.21499
summary(glm(attack ~scale(Msch_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #0.35843
summary(glm(attack ~scale(oth_sum), subset(data_plants_paper,!is.na(phen)),family="binomial")) #-0.40260
summary(glm(attack ~scale(Mrub_sch_s), subset(data_plants_paper,!is.na(phen)),family="binomial")) #0.36009
#Univariate GLMs relating the number of eggs in plants with at least one egg to the abundance of different ant species (Table S1B)
summary(glm.nb(n_eggs_max~scale(allM_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #NS
summary(glm.nb(n_eggs_max~scale(Mrub_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #0.13664
summary(glm.nb(n_eggs_max~scale(Msca_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #-0.11955
summary(glm.nb(n_eggs_max~scale(Mrug_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #NS
summary(glm.nb(n_eggs_max~scale(Msch_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #NS
summary(glm.nb(n_eggs_max~scale(oth_sum), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0)))  #NS
summary(glm.nb(n_eggs_max~scale(Mrub_sch_s), subset(data_plants_paper,!is.na(phen)&n_eggs_max>0))) #0.11490
#Binomial GLM relating the probability of a shoot of G. pneumonanthe having eggs of P. alcon to shoot phenology, ant abundance,
#neighbor density and neighbor phenology, and to three different two-way interactions of these predictors (Table S2)
model1<-glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(data_plants_paper,!is.na(phen)),family="binomial")
summary(model1)
head(data_plants_paper)
#Read data ants
data_ants_paper<-read.table("C:/Users/User/Dropbox/SU/Projects/neighbourhood_effects/data/clean/data_ants_paper.txt",header=T,sep="\t",dec=".")
head(data_ants_paper)
head(data_plants_paper)
head(allplants)
summary(model1)
head(allplants)
e
e
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(data_plants_paper,!is.na(phen)),family="binomial") )
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(alldata,!is.na(phen)),family="binomial") )
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(allplants,!is.na(phen)),family="binomial") )
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(allplants,!is.na(phen)),family="binomial") )
names(allplants)
class(allplants)
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
as.data.frame(subset(allplants,!is.na(phen)))
datitos<-as.data.frame(subset(allplants,!is.na(phen)))
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
datitos,family="binomial") )
rm(datitos)
as.data.frame(subset(allplants,!is.na(phen)))$phen
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen):scale(Mrub_sch_s)+
scale(phen):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
subset(data_plants_paper,!is.na(phen)),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
names(allplants)
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_1) +
scale(phen_n1) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n1) + scale(pldens_1):scale(phen_n1),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_5) +
scale(phen_n5) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n5) + scale(pldens_5):scale(phen_n5),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_10) +
scale(phen_n10) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n10) + scale(pldens_10):scale(phen_n10),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
summary(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_5) +
scale(phen_n5) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n5) + scale(pldens_5):scale(phen_n5),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
library(fmsb)
NagelkerkeR2(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_3) +
scale(phen_n3) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n3) + scale(pldens_3):scale(phen_n3),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
NagelkerkeR2(glm(attack ~ scale(phen_int) + scale(Mrub_sch_s) + scale(pldens_5) +
scale(phen_n5) + scale(phen_int):scale(Mrub_sch_s)+
scale(phen_int):scale(phen_n5) + scale(pldens_5):scale(phen_n5),
as.data.frame(subset(allplants,!is.na(phen))),family="binomial") )
head(data_pts)
